<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 900 500">
  <defs>
    <marker id="arrowBlue" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <path d="M0,0 L0,6 L9,3 z" fill="#3498db"/>
    </marker>
    <marker id="arrowGreen" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <path d="M0,0 L0,6 L9,3 z" fill="#2ecc71"/>
    </marker>
    <linearGradient id="latentGrad" x1="0%" y1="0%" x2="100%" y2="0%">
      <stop offset="0%" style="stop-color:#9b59b6;stop-opacity:0.8"/>
      <stop offset="100%" style="stop-color:#3498db;stop-opacity:0.8"/>
    </linearGradient>
  </defs>

  <!-- Background -->
  <rect width="900" height="500" fill="#1a1a2e"/>

  <!-- Title -->
  <text x="450" y="35" text-anchor="middle" fill="#ffffff" font-family="Arial, sans-serif" font-size="22" font-weight="bold">Stable Diffusion 구조</text>

  <!-- Analogy Box -->
  <rect x="50" y="55" width="800" height="40" fill="#2c3e50" rx="5" stroke="#f39c12" stroke-width="1"/>
  <text x="450" y="80" text-anchor="middle" fill="#f39c12" font-family="Arial, sans-serif" font-size="12">
    비유: 화가가 (1) 스케치를 먼저 그리고 (2) 색을 입히듯, SD는 (1) 작은 latent에서 계획하고 (2) VAE로 확대합니다
  </text>

  <!-- Text Input -->
  <g transform="translate(50, 120)">
    <rect x="0" y="0" width="180" height="50" fill="#3498db" rx="8" opacity="0.9"/>
    <text x="90" y="22" text-anchor="middle" fill="#fff" font-family="Arial, sans-serif" font-size="12">"A cat playing piano"</text>
    <text x="90" y="40" text-anchor="middle" fill="#ddd" font-family="Arial, sans-serif" font-size="10">텍스트 프롬프트</text>
  </g>

  <!-- Arrow to CLIP -->
  <path d="M 235 145 L 270 145" stroke="#3498db" stroke-width="2" marker-end="url(#arrowBlue)"/>

  <!-- CLIP Text Encoder -->
  <g transform="translate(280, 110)">
    <rect x="0" y="0" width="140" height="70" fill="#2c3e50" rx="8" stroke="#e67e22" stroke-width="2"/>
    <text x="70" y="25" text-anchor="middle" fill="#e67e22" font-family="Arial, sans-serif" font-size="14" font-weight="bold">CLIP</text>
    <text x="70" y="45" text-anchor="middle" fill="#fff" font-family="Arial, sans-serif" font-size="11">Text Encoder</text>
    <text x="70" y="62" text-anchor="middle" fill="#888" font-family="Arial, sans-serif" font-size="9">77 × 768</text>
  </g>

  <!-- Text Embedding output -->
  <path d="M 420 145 L 450 145 L 450 260" stroke="#e67e22" stroke-width="2" stroke-dasharray="4,2"/>
  <text x="460" y="200" fill="#e67e22" font-family="Arial, sans-serif" font-size="10">text embedding</text>

  <!-- Random Noise -->
  <g transform="translate(650, 110)">
    <rect x="0" y="0" width="140" height="70" fill="#e74c3c" rx="8" opacity="0.8"/>
    <text x="70" y="22" text-anchor="middle" fill="#fff" font-family="Arial, sans-serif" font-size="12">Random Noise</text>
    <text x="70" y="42" text-anchor="middle" fill="#fff" font-family="Arial, sans-serif" font-size="14" font-weight="bold">z_T</text>
    <text x="70" y="60" text-anchor="middle" fill="#ddd" font-family="Arial, sans-serif" font-size="9">64 × 64 × 4</text>
  </g>

  <!-- Arrow from noise to U-Net -->
  <path d="M 720 180 L 720 220" stroke="#e74c3c" stroke-width="2" marker-end="url(#arrowBlue)"/>

  <!-- U-Net (Main) -->
  <g transform="translate(250, 230)">
    <rect x="0" y="0" width="400" height="130" fill="url(#latentGrad)" rx="10" stroke="#fff" stroke-width="2"/>
    <text x="200" y="30" text-anchor="middle" fill="#fff" font-family="Arial, sans-serif" font-size="18" font-weight="bold">U-Net (Denoising)</text>

    <!-- Cross Attention -->
    <rect x="30" y="50" width="100" height="50" fill="#2c3e50" rx="5" stroke="#e67e22" stroke-width="1"/>
    <text x="80" y="72" text-anchor="middle" fill="#e67e22" font-family="Arial, sans-serif" font-size="10">Cross</text>
    <text x="80" y="88" text-anchor="middle" fill="#e67e22" font-family="Arial, sans-serif" font-size="10">Attention</text>

    <!-- Self Attention -->
    <rect x="150" y="50" width="100" height="50" fill="#2c3e50" rx="5" stroke="#3498db" stroke-width="1"/>
    <text x="200" y="72" text-anchor="middle" fill="#3498db" font-family="Arial, sans-serif" font-size="10">Self</text>
    <text x="200" y="88" text-anchor="middle" fill="#3498db" font-family="Arial, sans-serif" font-size="10">Attention</text>

    <!-- ResBlock -->
    <rect x="270" y="50" width="100" height="50" fill="#2c3e50" rx="5" stroke="#2ecc71" stroke-width="1"/>
    <text x="320" y="72" text-anchor="middle" fill="#2ecc71" font-family="Arial, sans-serif" font-size="10">ResNet</text>
    <text x="320" y="88" text-anchor="middle" fill="#2ecc71" font-family="Arial, sans-serif" font-size="10">Block</text>

    <!-- Input/Output annotation -->
    <text x="200" y="120" text-anchor="middle" fill="#fff" font-family="Arial, sans-serif" font-size="10">Latent Space에서 작동 (64×64×4) - 빠르다!</text>
  </g>

  <!-- Timestep input -->
  <g transform="translate(50, 260)">
    <rect x="0" y="0" width="100" height="50" fill="#9b59b6" rx="5"/>
    <text x="50" y="22" text-anchor="middle" fill="#fff" font-family="Arial, sans-serif" font-size="11">Timestep</text>
    <text x="50" y="40" text-anchor="middle" fill="#fff" font-family="Arial, sans-serif" font-size="14" font-weight="bold">t</text>
  </g>
  <path d="M 150 285 L 240 285" stroke="#9b59b6" stroke-width="2" marker-end="url(#arrowBlue)"/>

  <!-- Iterative denoising loop -->
  <path d="M 650 360 L 720 360 L 720 220" stroke="#fff" stroke-width="2" stroke-dasharray="5,3" marker-end="url(#arrowBlue)"/>
  <text x="750" y="290" fill="#fff" font-family="Arial, sans-serif" font-size="10">반복</text>
  <text x="750" y="305" fill="#888" font-family="Arial, sans-serif" font-size="9">(50 steps)</text>

  <!-- Output latent -->
  <path d="M 450 360 L 450 395" stroke="#2ecc71" stroke-width="2" marker-end="url(#arrowGreen)"/>
  <text x="410" y="385" fill="#2ecc71" font-family="Arial, sans-serif" font-size="10">z_0</text>

  <!-- VAE Decoder -->
  <g transform="translate(350, 400)">
    <rect x="0" y="0" width="200" height="60" fill="#2c3e50" rx="8" stroke="#2ecc71" stroke-width="2"/>
    <text x="100" y="25" text-anchor="middle" fill="#2ecc71" font-family="Arial, sans-serif" font-size="14" font-weight="bold">VAE Decoder</text>
    <text x="100" y="48" text-anchor="middle" fill="#888" font-family="Arial, sans-serif" font-size="10">64×64 → 512×512 (8× 확대)</text>
  </g>

  <!-- Output Image -->
  <path d="M 550 430 L 620 430" stroke="#2ecc71" stroke-width="2" marker-end="url(#arrowGreen)"/>

  <g transform="translate(630, 390)">
    <rect x="0" y="0" width="120" height="80" fill="#2ecc71" rx="8"/>
    <text x="60" y="30" text-anchor="middle" fill="#fff" font-family="Arial, sans-serif" font-size="12">Generated</text>
    <text x="60" y="50" text-anchor="middle" fill="#fff" font-family="Arial, sans-serif" font-size="12">Image</text>
    <text x="60" y="70" text-anchor="middle" fill="#ddd" font-family="Arial, sans-serif" font-size="10">512 × 512</text>
  </g>

  <!-- Key insight box -->
  <rect x="50" y="410" width="280" height="65" fill="#2c3e50" rx="5" stroke="#3498db" stroke-width="1"/>
  <text x="60" y="430" fill="#3498db" font-family="Arial, sans-serif" font-size="11" font-weight="bold">핵심 포인트</text>
  <text x="60" y="448" fill="#fff" font-family="Arial, sans-serif" font-size="10">• Latent에서 Diffusion → 64× 계산량 절감</text>
  <text x="60" y="464" fill="#fff" font-family="Arial, sans-serif" font-size="10">• Cross-Attention → 텍스트 조건 주입</text>
</svg>