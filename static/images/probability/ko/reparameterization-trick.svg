<svg width="700" height="320" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <marker id="arrowReparam" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#333"/>
    </marker>
    <marker id="arrowRed" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#e74c3c"/>
    </marker>
    <marker id="arrowGreen" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#27ae60"/>
    </marker>
  </defs>

  <!-- Background -->
  <rect width="700" height="320" fill="#f8f9fa"/>

  <!-- Title -->
  <text x="350" y="28" text-anchor="middle" font-family="system-ui, sans-serif" font-size="18" font-weight="bold" fill="#333">
    Reparameterization Trick: Gradient가 흐르게 하는 방법
  </text>

  <!-- Method 1: Direct Sampling (Problem) -->
  <g transform="translate(30, 55)">
    <rect x="0" y="0" width="300" height="230" fill="#fdedec" stroke="#e74c3c" stroke-width="2" rx="10"/>
    <text x="150" y="25" text-anchor="middle" font-family="system-ui, sans-serif" font-size="14" font-weight="bold" fill="#c92a2a">
      ❌ 직접 샘플링 (Gradient 끊김)
    </text>

    <!-- mu, sigma boxes -->
    <rect x="30" y="50" width="60" height="35" fill="#3498db" stroke="#2980b9" stroke-width="2" rx="5"/>
    <text x="60" y="73" text-anchor="middle" font-family="system-ui, sans-serif" font-size="14" font-weight="bold" fill="#fff">μ</text>

    <rect x="110" y="50" width="60" height="35" fill="#9b59b6" stroke="#8e44ad" stroke-width="2" rx="5"/>
    <text x="140" y="73" text-anchor="middle" font-family="system-ui, sans-serif" font-size="14" font-weight="bold" fill="#fff">σ</text>

    <!-- Sampling box (problem) -->
    <rect x="70" y="110" width="100" height="40" fill="#e74c3c" stroke="#c0392b" stroke-width="2" rx="5"/>
    <text x="120" y="135" text-anchor="middle" font-family="system-ui, sans-serif" font-size="12" font-weight="bold" fill="#fff">샘플링</text>

    <!-- z output -->
    <rect x="85" y="175" width="70" height="35" fill="#f39c12" stroke="#d68910" stroke-width="2" rx="5"/>
    <text x="120" y="198" text-anchor="middle" font-family="system-ui, sans-serif" font-size="14" font-weight="bold" fill="#fff">z</text>

    <!-- Arrows (forward) -->
    <line x1="60" y1="85" x2="95" y2="105" stroke="#333" stroke-width="2" marker-end="url(#arrowReparam)"/>
    <line x1="140" y1="85" x2="145" y2="105" stroke="#333" stroke-width="2" marker-end="url(#arrowReparam)"/>
    <line x1="120" y1="150" x2="120" y2="170" stroke="#333" stroke-width="2" marker-end="url(#arrowReparam)"/>

    <!-- Gradient arrow (broken) -->
    <line x1="120" y1="215" x2="120" y2="235" stroke="#e74c3c" stroke-width="3" stroke-dasharray="5,3"/>
    <text x="120" y="250" text-anchor="middle" font-family="system-ui, sans-serif" font-size="10" fill="#c92a2a">
      ∂z/∂μ = ? ❌
    </text>

    <!-- X mark on sampling -->
    <text x="185" y="135" font-family="system-ui, sans-serif" font-size="16" fill="#c92a2a">← 확률적</text>
    <text x="185" y="152" font-family="system-ui, sans-serif" font-size="10" fill="#c92a2a">미분 불가!</text>
  </g>

  <!-- Method 2: Reparameterization (Solution) -->
  <g transform="translate(370, 55)">
    <rect x="0" y="0" width="300" height="230" fill="#e8f8f5" stroke="#27ae60" stroke-width="2" rx="10"/>
    <text x="150" y="25" text-anchor="middle" font-family="system-ui, sans-serif" font-size="14" font-weight="bold" fill="#27ae60">
      ✓ Reparameterization (Gradient 흐름)
    </text>

    <!-- mu, sigma boxes -->
    <rect x="30" y="50" width="60" height="35" fill="#3498db" stroke="#2980b9" stroke-width="2" rx="5"/>
    <text x="60" y="73" text-anchor="middle" font-family="system-ui, sans-serif" font-size="14" font-weight="bold" fill="#fff">μ</text>

    <rect x="110" y="50" width="60" height="35" fill="#9b59b6" stroke="#8e44ad" stroke-width="2" rx="5"/>
    <text x="140" y="73" text-anchor="middle" font-family="system-ui, sans-serif" font-size="14" font-weight="bold" fill="#fff">σ</text>

    <!-- epsilon (external noise) -->
    <rect x="210" y="85" width="60" height="30" fill="#bdc3c7" stroke="#95a5a6" stroke-width="2" rx="5"/>
    <text x="240" y="105" text-anchor="middle" font-family="system-ui, sans-serif" font-size="12" fill="#333">ε~N(0,1)</text>

    <!-- Operation box (deterministic) -->
    <rect x="70" y="110" width="100" height="40" fill="#27ae60" stroke="#1e8449" stroke-width="2" rx="5"/>
    <text x="120" y="128" text-anchor="middle" font-family="system-ui, sans-serif" font-size="11" font-weight="bold" fill="#fff">μ + σ × ε</text>
    <text x="120" y="142" text-anchor="middle" font-family="system-ui, sans-serif" font-size="9" fill="#fff">(결정적 연산)</text>

    <!-- z output -->
    <rect x="85" y="175" width="70" height="35" fill="#f39c12" stroke="#d68910" stroke-width="2" rx="5"/>
    <text x="120" y="198" text-anchor="middle" font-family="system-ui, sans-serif" font-size="14" font-weight="bold" fill="#fff">z</text>

    <!-- Arrows (forward) -->
    <line x1="60" y1="85" x2="95" y2="105" stroke="#333" stroke-width="2" marker-end="url(#arrowReparam)"/>
    <line x1="140" y1="85" x2="145" y2="105" stroke="#333" stroke-width="2" marker-end="url(#arrowReparam)"/>
    <line x1="210" y1="105" x2="175" y2="120" stroke="#333" stroke-width="2" marker-end="url(#arrowReparam)"/>
    <line x1="120" y1="150" x2="120" y2="170" stroke="#333" stroke-width="2" marker-end="url(#arrowReparam)"/>

    <!-- Gradient arrows (flowing) -->
    <path d="M 60 215 L 60 235 L 60 250" stroke="#27ae60" stroke-width="2" fill="none" marker-end="url(#arrowGreen)"/>
    <text x="60" y="265" text-anchor="middle" font-family="system-ui, sans-serif" font-size="10" fill="#27ae60">
      ∂z/∂μ = 1 ✓
    </text>

    <path d="M 140 215 L 140 235 L 140 250" stroke="#27ae60" stroke-width="2" fill="none" marker-end="url(#arrowGreen)"/>
    <text x="140" y="265" text-anchor="middle" font-family="system-ui, sans-serif" font-size="10" fill="#27ae60">
      ∂z/∂σ = ε ✓
    </text>
  </g>

  <!-- Formula Box -->
  <rect x="150" y="290" width="400" height="25" fill="#fff" stroke="#3498db" stroke-width="1" rx="5"/>
  <text x="350" y="307" text-anchor="middle" font-family="Times New Roman, serif" font-size="14" fill="#333">
    핵심: z = μ + σ · ε 로 분리 → μ, σ에 대해 미분 가능!
  </text>
</svg>
